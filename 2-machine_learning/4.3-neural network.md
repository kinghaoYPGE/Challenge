## Neural Network(神经网络)

神经网络是机器学习的一种算法, 它是仿生于人类脑细胞

与逻辑回归相比，当数据有很多特征时，想要更好的拟合数据，这个时候的模型定是一个多项式，如果直接使用逻辑回归，第一，计算量太大，第二，得到的模型效果不一定好。而使用神经网络，就会一层一层的去计算。而不是直接输出结果。下面我们来了解神经网络算法是如何工作的。

### 1. 模型

![enter description here](https://github.com/ayamefing/MachineLearning_Python/raw/master/images/NeuralNetwork_01.png)

 

- 先介绍个三层的神经网络，如下图所示
- 输入层（input layer）有三个units（[![{x_0}](https://camo.githubusercontent.com/b49a334e657fbda9eb91b9f7917378c042de41be/687474703a2f2f63686172742e617069732e676f6f676c652e636f6d2f63686172743f6368743d7478266368733d317830266368663d62672c732c4646464646463030266368636f3d3030303030302663686c3d253742785f30253744)](https://camo.githubusercontent.com/b49a334e657fbda9eb91b9f7917378c042de41be/687474703a2f2f63686172742e617069732e676f6f676c652e636f6d2f63686172743f6368743d7478266368733d317830266368663d62672c732c4646464646463030266368636f3d3030303030302663686c3d253742785f30253744)为补上的bias，通常设为`1`）
- [![a_i^{(j)}](https://camo.githubusercontent.com/201d41d5a9036a6ea8ecfd2f3d5eb51f9c4af4b0/687474703a2f2f63686172742e617069732e676f6f676c652e636f6d2f63686172743f6368743d7478266368733d317830266368663d62672c732c4646464646463030266368636f3d3030303030302663686c3d615f692535452537422532386a253239253744)](https://camo.githubusercontent.com/201d41d5a9036a6ea8ecfd2f3d5eb51f9c4af4b0/687474703a2f2f63686172742e617069732e676f6f676c652e636f6d2f63686172743f6368743d7478266368733d317830266368663d62672c732c4646464646463030266368636f3d3030303030302663686c3d615f692535452537422532386a253239253744)表示第`j`层的第`i`个激励，也称为为单元unit
- [![{\theta ^{(j)}}](https://camo.githubusercontent.com/4d39ae5e64c3149e85204aa3075c61c510efbd46/687474703a2f2f63686172742e617069732e676f6f676c652e636f6d2f63686172743f6368743d7478266368733d317830266368663d62672c732c4646464646463030266368636f3d3030303030302663686c3d25374225354374686574612532302535452537422532386a253239253744253744)](https://camo.githubusercontent.com/4d39ae5e64c3149e85204aa3075c61c510efbd46/687474703a2f2f63686172742e617069732e676f6f676c652e636f6d2f63686172743f6368743d7478266368733d317830266368663d62672c732c4646464646463030266368636f3d3030303030302663686c3d25374225354374686574612532302535452537422532386a253239253744253744)为第`j`层到第`j+1`层映射的权重矩阵，就是每条边的权重 

得到公式：

- 隐含层（第二层）：
  [![a_1^{(2)} = g(\theta _{10}^{(1)}{x_0} + \theta _{11}^{(1)}{x_1} + \theta _{12}^{(1)}{x_2} + \theta _{13}^{(1)}{x_3})](https://camo.githubusercontent.com/0d3feff3b98a9e3dabf1c0984f26df13c3589044/687474703a2f2f63686172742e617069732e676f6f676c652e636f6d2f63686172743f6368743d7478266368733d317830266368663d62672c732c4646464646463030266368636f3d3030303030302663686c3d615f31253545253742253238322532392537442532302533442532306725323825354374686574612532305f253742313025374425354525374225323831253239253744253742785f3025374425323025324225323025354374686574612532305f253742313125374425354525374225323831253239253744253742785f3125374425323025324225323025354374686574612532305f253742313225374425354525374225323831253239253744253742785f3225374425323025324225323025354374686574612532305f253742313325374425354525374225323831253239253744253742785f33253744253239)](https://camo.githubusercontent.com/0d3feff3b98a9e3dabf1c0984f26df13c3589044/687474703a2f2f63686172742e617069732e676f6f676c652e636f6d2f63686172743f6368743d7478266368733d317830266368663d62672c732c4646464646463030266368636f3d3030303030302663686c3d615f31253545253742253238322532392537442532302533442532306725323825354374686574612532305f253742313025374425354525374225323831253239253744253742785f3025374425323025324225323025354374686574612532305f253742313125374425354525374225323831253239253744253742785f3125374425323025324225323025354374686574612532305f253742313225374425354525374225323831253239253744253742785f3225374425323025324225323025354374686574612532305f253742313325374425354525374225323831253239253744253742785f33253744253239)
  [![a_2^{(2)} = g(\theta _{20}^{(1)}{x_0} + \theta _{21}^{(1)}{x_1} + \theta _{22}^{(1)}{x_2} + \theta _{23}^{(1)}{x_3})](https://camo.githubusercontent.com/a36ed777347b34deb1f47abd28b1dc86ce20b4a3/687474703a2f2f63686172742e617069732e676f6f676c652e636f6d2f63686172743f6368743d7478266368733d317830266368663d62672c732c4646464646463030266368636f3d3030303030302663686c3d615f32253545253742253238322532392537442532302533442532306725323825354374686574612532305f253742323025374425354525374225323831253239253744253742785f3025374425323025324225323025354374686574612532305f253742323125374425354525374225323831253239253744253742785f3125374425323025324225323025354374686574612532305f253742323225374425354525374225323831253239253744253742785f3225374425323025324225323025354374686574612532305f253742323325374425354525374225323831253239253744253742785f33253744253239)](https://camo.githubusercontent.com/a36ed777347b34deb1f47abd28b1dc86ce20b4a3/687474703a2f2f63686172742e617069732e676f6f676c652e636f6d2f63686172743f6368743d7478266368733d317830266368663d62672c732c4646464646463030266368636f3d3030303030302663686c3d615f32253545253742253238322532392537442532302533442532306725323825354374686574612532305f253742323025374425354525374225323831253239253744253742785f3025374425323025324225323025354374686574612532305f253742323125374425354525374225323831253239253744253742785f3125374425323025324225323025354374686574612532305f253742323225374425354525374225323831253239253744253742785f3225374425323025324225323025354374686574612532305f253742323325374425354525374225323831253239253744253742785f33253744253239)
  [![a_3^{(2)} = g(\theta _{30}^{(1)}{x_0} + \theta _{31}^{(1)}{x_1} + \theta _{32}^{(1)}{x_2} + \theta _{33}^{(1)}{x_3})](https://camo.githubusercontent.com/61712ea322de35d8e95d9327810ff89339e18deb/687474703a2f2f63686172742e617069732e676f6f676c652e636f6d2f63686172743f6368743d7478266368733d317830266368663d62672c732c4646464646463030266368636f3d3030303030302663686c3d615f33253545253742253238322532392537442532302533442532306725323825354374686574612532305f253742333025374425354525374225323831253239253744253742785f3025374425323025324225323025354374686574612532305f253742333125374425354525374225323831253239253744253742785f3125374425323025324225323025354374686574612532305f253742333225374425354525374225323831253239253744253742785f3225374425323025324225323025354374686574612532305f253742333325374425354525374225323831253239253744253742785f33253744253239)](https://camo.githubusercontent.com/61712ea322de35d8e95d9327810ff89339e18deb/687474703a2f2f63686172742e617069732e676f6f676c652e636f6d2f63686172743f6368743d7478266368733d317830266368663d62672c732c4646464646463030266368636f3d3030303030302663686c3d615f33253545253742253238322532392537442532302533442532306725323825354374686574612532305f253742333025374425354525374225323831253239253744253742785f3025374425323025324225323025354374686574612532305f253742333125374425354525374225323831253239253744253742785f3125374425323025324225323025354374686574612532305f253742333225374425354525374225323831253239253744253742785f3225374425323025324225323025354374686574612532305f253742333325374425354525374225323831253239253744253742785f33253744253239)
- 输出层（第三层）
  [![{h_\theta }(x) = a_1^{(3)} = g(\theta _{10}^{(2)}a_0^{(2)} + \theta _{11}^{(2)}a_1^{(2)} + \theta _{12}^{(2)}a_2^{(2)} + \theta _{13}^{(2)}a_3^{(2)})](https://camo.githubusercontent.com/ab36d84ea159dd0486a95245d5253517f1e3ab63/687474703a2f2f63686172742e617069732e676f6f676c652e636f6d2f63686172743f6368743d7478266368733d317830266368663d62672c732c4646464646463030266368636f3d3030303030302663686c3d253742685f253543746865746125323025374425323878253239253230253344253230615f31253545253742253238332532392537442532302533442532306725323825354374686574612532305f253742313025374425354525374225323832253239253744615f302535452537422532383225323925374425323025324225323025354374686574612532305f253742313125374425354525374225323832253239253744615f312535452537422532383225323925374425323025324225323025354374686574612532305f253742313225374425354525374225323832253239253744615f322535452537422532383225323925374425323025324225323025354374686574612532305f253742313325374425354525374225323832253239253744615f3325354525374225323832253239253744253239)](https://camo.githubusercontent.com/ab36d84ea159dd0486a95245d5253517f1e3ab63/687474703a2f2f63686172742e617069732e676f6f676c652e636f6d2f63686172743f6368743d7478266368733d317830266368663d62672c732c4646464646463030266368636f3d3030303030302663686c3d253742685f253543746865746125323025374425323878253239253230253344253230615f31253545253742253238332532392537442532302533442532306725323825354374686574612532305f253742313025374425354525374225323832253239253744615f302535452537422532383225323925374425323025324225323025354374686574612532305f253742313125374425354525374225323832253239253744615f312535452537422532383225323925374425323025324225323025354374686574612532305f253742313225374425354525374225323832253239253744615f322535452537422532383225323925374425323025324225323025354374686574612532305f253742313325374425354525374225323832253239253744615f3325354525374225323832253239253744253239) 其中，**S型函数**[![g(z) = \frac{1}{{1 + {e^{ - z}}}}](https://camo.githubusercontent.com/8763785659e321f0528e9bfef867d48d4305f688/687474703a2f2f63686172742e617069732e676f6f676c652e636f6d2f63686172743f6368743d7478266368733d317830266368663d62672c732c4646464646463030266368636f3d3030303030302663686c3d672532387a253239253230253344253230253543667261632537423125374425374225374231253230253242253230253742652535452537422532302d2532307a253744253744253744253744)](https://camo.githubusercontent.com/8763785659e321f0528e9bfef867d48d4305f688/687474703a2f2f63686172742e617069732e676f6f676c652e636f6d2f63686172743f6368743d7478266368733d317830266368663d62672c732c4646464646463030266368636f3d3030303030302663686c3d672532387a253239253230253344253230253543667261632537423125374425374225374231253230253242253230253742652535452537422532302d2532307a253744253744253744253744)，也成为**激励函数**
- 可以看出[![{\theta ^{(1)}}](https://camo.githubusercontent.com/52ca4b332da1960635d8fa1b0dc45a52d7bd0536/687474703a2f2f63686172742e617069732e676f6f676c652e636f6d2f63686172743f6368743d7478266368733d317830266368663d62672c732c4646464646463030266368636f3d3030303030302663686c3d253742253543746865746125323025354525374225323831253239253744253744)](https://camo.githubusercontent.com/52ca4b332da1960635d8fa1b0dc45a52d7bd0536/687474703a2f2f63686172742e617069732e676f6f676c652e636f6d2f63686172743f6368743d7478266368733d317830266368663d62672c732c4646464646463030266368636f3d3030303030302663686c3d253742253543746865746125323025354525374225323831253239253744253744) 为3x4的矩阵，[![{\theta ^{(2)}}](https://camo.githubusercontent.com/3ec17f79221fa86871619995485c5bee8cbd7fc8/687474703a2f2f63686172742e617069732e676f6f676c652e636f6d2f63686172743f6368743d7478266368733d317830266368663d62672c732c4646464646463030266368636f3d3030303030302663686c3d253742253543746865746125323025354525374225323832253239253744253744)](https://camo.githubusercontent.com/3ec17f79221fa86871619995485c5bee8cbd7fc8/687474703a2f2f63686172742e617069732e676f6f676c652e636f6d2f63686172743f6368743d7478266368733d317830266368663d62672c732c4646464646463030266368636f3d3030303030302663686c3d253742253543746865746125323025354525374225323832253239253744253744)为1x4的矩阵
- [![{\theta ^{(j)}}](https://camo.githubusercontent.com/4d39ae5e64c3149e85204aa3075c61c510efbd46/687474703a2f2f63686172742e617069732e676f6f676c652e636f6d2f63686172743f6368743d7478266368733d317830266368663d62672c732c4646464646463030266368636f3d3030303030302663686c3d25374225354374686574612532302535452537422532386a253239253744253744)](https://camo.githubusercontent.com/4d39ae5e64c3149e85204aa3075c61c510efbd46/687474703a2f2f63686172742e617069732e676f6f676c652e636f6d2f63686172743f6368743d7478266368733d317830266368663d62672c732c4646464646463030266368636f3d3030303030302663686c3d25374225354374686574612532302535452537422532386a253239253744253744) ==》`j+1`的单元数x（`j`层的单元数+1

### 2. 代价函数

其实，这里的代价函数和逻辑回归类似，但是由于神经网络的输出可能不止一个，所以需要修改下cost function

![J(\Theta ) =  - \frac{1}{m}\sum\limits_{i = 1}^m {\sum\limits_{k = 1}^K {[y_k^{(i)}\log {{({h_\Theta }({x^{(i)}}))}k}} }  + (1 - y_k^{(i)})\log {(1 - {h\Theta }({x^{(i)}}))_k}]](https://camo.githubusercontent.com/11d61df709b57f73fd7823d93f8dce7fbac94870/687474703a2f2f63686172742e617069732e676f6f676c652e636f6d2f63686172743f6368743d7478266368733d317830266368663d62672c732c4646464646463030266368636f3d3030303030302663686c3d4a25323825354354686574612532302532392532302533442532302532302d25323025354366726163253742312537442537426d25374425354373756d2535436c696d6974735f25374269253230253344253230312537442535456d25323025374225354373756d2535436c696d6974735f2537426b253230253344253230312537442535454b253230253742253542795f6b253545253742253238692532392537442535436c6f67253230253742253742253238253742685f253543546865746125323025374425323825374278253545253742253238692532392537442537442532392532392537445f6b253744253744253230253744253230253230253242253230253238312532302d253230795f6b253545253742253238692532392537442532392535436c6f67253230253742253238312532302d253230253742685f253543546865746125323025374425323825374278253545253742253238692532392537442537442532392532395f6b253744253544) 

**正则化后**：

![enter description here](https://github.com/ayamefing/MachineLearning_Python/raw/master/images/NeuralNetwork_02.png) 

- `L`-->所有层的个数
- [![{S_l}](https://camo.githubusercontent.com/a2eb9f69b5a3b4aa764414ba42d33cdd5dca9bbb/687474703a2f2f63686172742e617069732e676f6f676c652e636f6d2f63686172743f6368743d7478266368733d317830266368663d62672c732c4646464646463030266368636f3d3030303030302663686c3d253742535f6c253744)](https://camo.githubusercontent.com/a2eb9f69b5a3b4aa764414ba42d33cdd5dca9bbb/687474703a2f2f63686172742e617069732e676f6f676c652e636f6d2f63686172743f6368743d7478266368733d317830266368663d62672c732c4646464646463030266368636f3d3030303030302663686c3d253742535f6c253744)-->第`l`层unit的个数

### 3. 反向传播(BP)

- 上面正向传播可以计算得到`J(θ)`,使用梯度下降法还需要求它的梯度
- **BP反向传播的目的就是求代价函数的梯度**
- 假设4层的神经网络,[![\delta _{\text{j}}^{(l)}](https://camo.githubusercontent.com/d1909061fdf3707e6550d5fb9711971022e028c4/687474703a2f2f63686172742e617069732e676f6f676c652e636f6d2f63686172743f6368743d7478266368733d317830266368663d62672c732c4646464646463030266368636f3d3030303030302663686c3d25354364656c74612532305f253742253543746578742537426a2537442537442535452537422532386c253239253744)](https://camo.githubusercontent.com/d1909061fdf3707e6550d5fb9711971022e028c4/687474703a2f2f63686172742e617069732e676f6f676c652e636f6d2f63686172743f6368743d7478266368733d317830266368663d62672c732c4646464646463030266368636f3d3030303030302663686c3d25354364656c74612532305f253742253543746578742537426a2537442537442535452537422532386c253239253744)记为-->`l`层第`j`个单元的误差
- [![\delta _{\text{j}}^{(4)} = a_j^{(4)} - {y_i}](https://camo.githubusercontent.com/d7293c4bde3f35d90804f4425e36a52043ca6805/687474703a2f2f63686172742e617069732e676f6f676c652e636f6d2f63686172743f6368743d7478266368733d317830266368663d62672c732c4646464646463030266368636f3d3030303030302663686c3d25354364656c74612532305f253742253543746578742537426a25374425374425354525374225323834253239253744253230253344253230615f6a253545253742253238342532392537442532302d253230253742795f69253744)](https://camo.githubusercontent.com/d7293c4bde3f35d90804f4425e36a52043ca6805/687474703a2f2f63686172742e617069732e676f6f676c652e636f6d2f63686172743f6368743d7478266368733d317830266368663d62672c732c4646464646463030266368636f3d3030303030302663686c3d25354364656c74612532305f253742253543746578742537426a25374425374425354525374225323834253239253744253230253344253230615f6a253545253742253238342532392537442532302d253230253742795f69253744)《===》[![{\delta ^{(4)}} = {a^{(4)}} - y](https://camo.githubusercontent.com/1138528ab3e0df4f8116b0a0936032fb8fb91c25/687474703a2f2f63686172742e617069732e676f6f676c652e636f6d2f63686172743f6368743d7478266368733d317830266368663d62672c732c4646464646463030266368636f3d3030303030302663686c3d25374225354364656c74612532302535452537422532383425323925374425374425323025334425323025374261253545253742253238342532392537442537442532302d25323079)](https://camo.githubusercontent.com/1138528ab3e0df4f8116b0a0936032fb8fb91c25/687474703a2f2f63686172742e617069732e676f6f676c652e636f6d2f63686172743f6368743d7478266368733d317830266368663d62672c732c4646464646463030266368636f3d3030303030302663686c3d25374225354364656c74612532302535452537422532383425323925374425374425323025334425323025374261253545253742253238342532392537442537442532302d25323079)（向量化）
- [![{\delta ^{(3)}} = {({\theta ^{(3)}})^T}{\delta ^{(4)}}.*{g^}({a^{(3)}})](https://camo.githubusercontent.com/e332f017b828971a4ac70bf36e02a8363957adb8/687474703a2f2f63686172742e617069732e676f6f676c652e636f6d2f63686172743f6368743d7478266368733d317830266368663d62672c732c4646464646463030266368636f3d3030303030302663686c3d25374225354364656c7461253230253545253742253238332532392537442537442532302533442532302537422532382537422535437468657461253230253545253742253238332532392537442537442532392535455425374425374225354364656c7461253230253545253742253238342532392537442537442e253241253742672535452537442532382537426125354525374225323833253239253744253744253239)](https://camo.githubusercontent.com/e332f017b828971a4ac70bf36e02a8363957adb8/687474703a2f2f63686172742e617069732e676f6f676c652e636f6d2f63686172743f6368743d7478266368733d317830266368663d62672c732c4646464646463030266368636f3d3030303030302663686c3d25374225354364656c7461253230253545253742253238332532392537442537442532302533442532302537422532382537422535437468657461253230253545253742253238332532392537442537442532392535455425374425374225354364656c7461253230253545253742253238342532392537442537442e253241253742672535452537442532382537426125354525374225323833253239253744253744253239)
- [![{\delta ^{(2)}} = {({\theta ^{(2)}})^T}{\delta ^{(3)}}.*{g^}({a^{(2)}})](https://camo.githubusercontent.com/145b6458f69424a7dbbde744df5e66aab5a70076/687474703a2f2f63686172742e617069732e676f6f676c652e636f6d2f63686172743f6368743d7478266368733d317830266368663d62672c732c4646464646463030266368636f3d3030303030302663686c3d25374225354364656c7461253230253545253742253238322532392537442537442532302533442532302537422532382537422535437468657461253230253545253742253238322532392537442537442532392535455425374425374225354364656c7461253230253545253742253238332532392537442537442e253241253742672535452537442532382537426125354525374225323832253239253744253744253239)](https://camo.githubusercontent.com/145b6458f69424a7dbbde744df5e66aab5a70076/687474703a2f2f63686172742e617069732e676f6f676c652e636f6d2f63686172743f6368743d7478266368733d317830266368663d62672c732c4646464646463030266368636f3d3030303030302663686c3d25374225354364656c7461253230253545253742253238322532392537442537442532302533442532302537422532382537422535437468657461253230253545253742253238322532392537442537442532392535455425374425374225354364656c7461253230253545253742253238332532392537442537442e253241253742672535452537442532382537426125354525374225323832253239253744253744253239)
- 没有[![{\delta ^{(1)}}](https://camo.githubusercontent.com/950f645071e8c84affe71976ef66cfa3e9d38254/687474703a2f2f63686172742e617069732e676f6f676c652e636f6d2f63686172743f6368743d7478266368733d317830266368663d62672c732c4646464646463030266368636f3d3030303030302663686c3d25374225354364656c746125323025354525374225323831253239253744253744)](https://camo.githubusercontent.com/950f645071e8c84affe71976ef66cfa3e9d38254/687474703a2f2f63686172742e617069732e676f6f676c652e636f6d2f63686172743f6368743d7478266368733d317830266368663d62672c732c4646464646463030266368636f3d3030303030302663686c3d25374225354364656c746125323025354525374225323831253239253744253744)，因为对于输入没有误差
- 因为S型函数[![{\text{g(z)}}](https://camo.githubusercontent.com/ce4c5e54c91e8b280f3bf03855e5b392e3845f5d/687474703a2f2f63686172742e617069732e676f6f676c652e636f6d2f63686172743f6368743d7478266368733d317830266368663d62672c732c4646464646463030266368636f3d3030303030302663686c3d25374225354374657874253742672532387a253239253744253744)](https://camo.githubusercontent.com/ce4c5e54c91e8b280f3bf03855e5b392e3845f5d/687474703a2f2f63686172742e617069732e676f6f676c652e636f6d2f63686172743f6368743d7478266368733d317830266368663d62672c732c4646464646463030266368636f3d3030303030302663686c3d25374225354374657874253742672532387a253239253744253744)的导数为：[![{g^}(z){\text{ = g(z)(1 - g(z))}}](https://camo.githubusercontent.com/ef9d7dcb50db1498f07869e207d0ef9c2345c7fa/687474703a2f2f63686172742e617069732e676f6f676c652e636f6d2f63686172743f6368743d7478266368733d317830266368663d62672c732c4646464646463030266368636f3d3030303030302663686c3d253742672535452537442532387a25323925374225354374657874253742253230253344253230672532387a253239253238312532302d253230672532387a253239253239253744253744)](https://camo.githubusercontent.com/ef9d7dcb50db1498f07869e207d0ef9c2345c7fa/687474703a2f2f63686172742e617069732e676f6f676c652e636f6d2f63686172743f6368743d7478266368733d317830266368663d62672c732c4646464646463030266368636f3d3030303030302663686c3d253742672535452537442532387a25323925374225354374657874253742253230253344253230672532387a253239253238312532302d253230672532387a253239253239253744253744)，所以上面的[![{g^}({a^{(3)}})](https://camo.githubusercontent.com/226645161ca6a8034de7edd988a8861c09574283/687474703a2f2f63686172742e617069732e676f6f676c652e636f6d2f63686172743f6368743d7478266368733d317830266368663d62672c732c4646464646463030266368636f3d3030303030302663686c3d253742672535452537442532382537426125354525374225323833253239253744253744253239)](https://camo.githubusercontent.com/226645161ca6a8034de7edd988a8861c09574283/687474703a2f2f63686172742e617069732e676f6f676c652e636f6d2f63686172743f6368743d7478266368733d317830266368663d62672c732c4646464646463030266368636f3d3030303030302663686c3d253742672535452537442532382537426125354525374225323833253239253744253744253239)和[![{g^}({a^{(2)}})](https://camo.githubusercontent.com/3a402feccbad71b8d3ecc940806a02f41ddbae4f/687474703a2f2f63686172742e617069732e676f6f676c652e636f6d2f63686172743f6368743d7478266368733d317830266368663d62672c732c4646464646463030266368636f3d3030303030302663686c3d253742672535452537442532382537426125354525374225323832253239253744253744253239)](https://camo.githubusercontent.com/3a402feccbad71b8d3ecc940806a02f41ddbae4f/687474703a2f2f63686172742e617069732e676f6f676c652e636f6d2f63686172743f6368743d7478266368733d317830266368663d62672c732c4646464646463030266368636f3d3030303030302663686c3d253742672535452537442532382537426125354525374225323832253239253744253744253239)可以在前向传播中计算出来
- 反向传播计算梯度的过程为：
- [![\Delta _{ij}^{(l)} = 0](https://camo.githubusercontent.com/51f2c2421bc8555cac551d8192568ae9f3106121/687474703a2f2f63686172742e617069732e676f6f676c652e636f6d2f63686172743f6368743d7478266368733d317830266368663d62672c732c4646464646463030266368636f3d3030303030302663686c3d25354344656c74612532305f253742696a2537442535452537422532386c25323925374425323025334425323030)](https://camo.githubusercontent.com/51f2c2421bc8555cac551d8192568ae9f3106121/687474703a2f2f63686172742e617069732e676f6f676c652e636f6d2f63686172743f6368743d7478266368733d317830266368663d62672c732c4646464646463030266368636f3d3030303030302663686c3d25354344656c74612532305f253742696a2537442535452537422532386c25323925374425323025334425323030)（[![\Delta ](https://camo.githubusercontent.com/a5378652e164108c371ea0376cd59fc06b5013b9/687474703a2f2f63686172742e617069732e676f6f676c652e636f6d2f63686172743f6368743d7478266368733d317830266368663d62672c732c4646464646463030266368636f3d3030303030302663686c3d25354344656c7461253230)](https://camo.githubusercontent.com/a5378652e164108c371ea0376cd59fc06b5013b9/687474703a2f2f63686172742e617069732e676f6f676c652e636f6d2f63686172743f6368743d7478266368733d317830266368663d62672c732c4646464646463030266368636f3d3030303030302663686c3d25354344656c7461253230)是大写的[![\delta ](https://camo.githubusercontent.com/2e281ad830d27d4d34d2a48bf5899a1d1a839dc2/687474703a2f2f63686172742e617069732e676f6f676c652e636f6d2f63686172743f6368743d7478266368733d317830266368663d62672c732c4646464646463030266368636f3d3030303030302663686c3d25354364656c7461253230)](https://camo.githubusercontent.com/2e281ad830d27d4d34d2a48bf5899a1d1a839dc2/687474703a2f2f63686172742e617069732e676f6f676c652e636f6d2f63686172743f6368743d7478266368733d317830266368663d62672c732c4646464646463030266368636f3d3030303030302663686c3d25354364656c7461253230)）
- for i=1-m:
  -[![{a^{(1)}} = {x^{(i)}}](https://camo.githubusercontent.com/c6b71a723549dcbf6382bf8885c2613f60f1cc62/687474703a2f2f63686172742e617069732e676f6f676c652e636f6d2f63686172743f6368743d7478266368733d317830266368663d62672c732c4646464646463030266368636f3d3030303030302663686c3d25374261253545253742253238312532392537442537442532302533442532302537427825354525374225323869253239253744253744)](https://camo.githubusercontent.com/c6b71a723549dcbf6382bf8885c2613f60f1cc62/687474703a2f2f63686172742e617069732e676f6f676c652e636f6d2f63686172743f6368743d7478266368733d317830266368663d62672c732c4646464646463030266368636f3d3030303030302663686c3d25374261253545253742253238312532392537442537442532302533442532302537427825354525374225323869253239253744253744)
  -正向传播计算[![{a^{(l)}}](https://camo.githubusercontent.com/c8e9819caae94169b9285d2aecee664f9a8db61c/687474703a2f2f63686172742e617069732e676f6f676c652e636f6d2f63686172743f6368743d7478266368733d317830266368663d62672c732c4646464646463030266368636f3d3030303030302663686c3d253742612535452537422532386c253239253744253744)](https://camo.githubusercontent.com/c8e9819caae94169b9285d2aecee664f9a8db61c/687474703a2f2f63686172742e617069732e676f6f676c652e636f6d2f63686172743f6368743d7478266368733d317830266368663d62672c732c4646464646463030266368636f3d3030303030302663686c3d253742612535452537422532386c253239253744253744)（l=2,3,4...L）
  -反向计算[![{\delta ^{(L)}}](https://camo.githubusercontent.com/2688872763a2319bf40b6d026d8cdb4e7e5d8c3a/687474703a2f2f63686172742e617069732e676f6f676c652e636f6d2f63686172743f6368743d7478266368733d317830266368663d62672c732c4646464646463030266368636f3d3030303030302663686c3d25374225354364656c74612532302535452537422532384c253239253744253744)](https://camo.githubusercontent.com/2688872763a2319bf40b6d026d8cdb4e7e5d8c3a/687474703a2f2f63686172742e617069732e676f6f676c652e636f6d2f63686172743f6368743d7478266368733d317830266368663d62672c732c4646464646463030266368636f3d3030303030302663686c3d25374225354364656c74612532302535452537422532384c253239253744253744)、[![{\delta ^{(L - 1)}}](https://camo.githubusercontent.com/2dd98f644cbf4e827993c39d290016e555a74533/687474703a2f2f63686172742e617069732e676f6f676c652e636f6d2f63686172743f6368743d7478266368733d317830266368663d62672c732c4646464646463030266368636f3d3030303030302663686c3d25374225354364656c74612532302535452537422532384c2532302d25323031253239253744253744)](https://camo.githubusercontent.com/2dd98f644cbf4e827993c39d290016e555a74533/687474703a2f2f63686172742e617069732e676f6f676c652e636f6d2f63686172743f6368743d7478266368733d317830266368663d62672c732c4646464646463030266368636f3d3030303030302663686c3d25374225354364656c74612532302535452537422532384c2532302d25323031253239253744253744)...[![{\delta ^{(2)}}](https://camo.githubusercontent.com/62a361d936a04a11babc77179bbd997694e8c7b3/687474703a2f2f63686172742e617069732e676f6f676c652e636f6d2f63686172743f6368743d7478266368733d317830266368663d62672c732c4646464646463030266368636f3d3030303030302663686c3d25374225354364656c746125323025354525374225323832253239253744253744)](https://camo.githubusercontent.com/62a361d936a04a11babc77179bbd997694e8c7b3/687474703a2f2f63686172742e617069732e676f6f676c652e636f6d2f63686172743f6368743d7478266368733d317830266368663d62672c732c4646464646463030266368636f3d3030303030302663686c3d25374225354364656c746125323025354525374225323832253239253744253744)；
  -[![\Delta _{ij}^{(l)} = \Delta _{ij}^{(l)} + a_j^{(l)}{\delta ^{(l + 1)}}](https://camo.githubusercontent.com/adabf5fa6d424d1d79f6aaf33ab2d4a898328c3f/687474703a2f2f63686172742e617069732e676f6f676c652e636f6d2f63686172743f6368743d7478266368733d317830266368663d62672c732c4646464646463030266368636f3d3030303030302663686c3d25354344656c74612532305f253742696a2537442535452537422532386c25323925374425323025334425323025354344656c74612532305f253742696a2537442535452537422532386c253239253744253230253242253230615f6a2535452537422532386c25323925374425374225354364656c74612532302535452537422532386c25323025324225323031253239253744253744)](https://camo.githubusercontent.com/adabf5fa6d424d1d79f6aaf33ab2d4a898328c3f/687474703a2f2f63686172742e617069732e676f6f676c652e636f6d2f63686172743f6368743d7478266368733d317830266368663d62672c732c4646464646463030266368636f3d3030303030302663686c3d25354344656c74612532305f253742696a2537442535452537422532386c25323925374425323025334425323025354344656c74612532305f253742696a2537442535452537422532386c253239253744253230253242253230615f6a2535452537422532386c25323925374425374225354364656c74612532302535452537422532386c25323025324225323031253239253744253744)
  -[![D_{ij}^{(l)} = \frac{1}{m}\Delta _{ij}^{(l)} + \lambda \theta _{ij}^l\begin{array}{c}    {}& {(j \ne 0)}  \end{array} ](https://camo.githubusercontent.com/0dd05c5a1c837f5a434411f8e05a8df4eae0a61c/687474703a2f2f63686172742e617069732e676f6f676c652e636f6d2f63686172743f6368743d7478266368733d317830266368663d62672c732c4646464646463030266368636f3d3030303030302663686c3d445f253742696a2537442535452537422532386c25323925374425323025334425323025354366726163253742312537442537426d25374425354344656c74612532305f253742696a2537442535452537422532386c2532392537442532302532422532302535436c616d62646125323025354374686574612532305f253742696a2537442535456c253543626567696e2537426172726179253744253742632537442532302532302532302532302537422537442532362532302537422532386a2532302535436e6525323030253239253744253230253230253543656e642537426172726179253744253230)](https://camo.githubusercontent.com/0dd05c5a1c837f5a434411f8e05a8df4eae0a61c/687474703a2f2f63686172742e617069732e676f6f676c652e636f6d2f63686172743f6368743d7478266368733d317830266368663d62672c732c4646464646463030266368636f3d3030303030302663686c3d445f253742696a2537442535452537422532386c25323925374425323025334425323025354366726163253742312537442537426d25374425354344656c74612532305f253742696a2537442535452537422532386c2532392537442532302532422532302535436c616d62646125323025354374686574612532305f253742696a2537442535456c253543626567696e2537426172726179253744253742632537442532302532302532302532302537422537442532362532302537422532386a2532302535436e6525323030253239253744253230253230253543656e642537426172726179253744253230)
  [![D_{ij}^{(l)} = \frac{1}{m}\Delta _{ij}^{(l)} + \lambda \theta _{ij}^lj = 0\begin{array}{c}    {}& {j = 0}  \end{array} ](https://camo.githubusercontent.com/20c6aa007f6b4320d1413e4518b4a9b72f57f6c5/687474703a2f2f63686172742e617069732e676f6f676c652e636f6d2f63686172743f6368743d7478266368733d317830266368663d62672c732c4646464646463030266368636f3d3030303030302663686c3d445f253742696a2537442535452537422532386c25323925374425323025334425323025354366726163253742312537442537426d25374425354344656c74612532305f253742696a2537442535452537422532386c2532392537442532302532422532302535436c616d62646125323025354374686574612532305f253742696a2537442535456c6a25323025334425323030253543626567696e2537426172726179253744253742632537442532302532302532302532302537422537442532362532302537426a25323025334425323030253744253230253230253543656e642537426172726179253744253230)](https://camo.githubusercontent.com/20c6aa007f6b4320d1413e4518b4a9b72f57f6c5/687474703a2f2f63686172742e617069732e676f6f676c652e636f6d2f63686172743f6368743d7478266368733d317830266368663d62672c732c4646464646463030266368636f3d3030303030302663686c3d445f253742696a2537442535452537422532386c25323925374425323025334425323025354366726163253742312537442537426d25374425354344656c74612532305f253742696a2537442535452537422532386c2532392537442532302532422532302535436c616d62646125323025354374686574612532305f253742696a2537442535456c6a25323025334425323030253543626567696e2537426172726179253744253742632537442532302532302532302532302537422537442532362532302537426a25323025334425323030253744253230253230253543656e642537426172726179253744253230)
- 最后[![\frac{{\partial J(\Theta )}}{{\partial \Theta {ij}^{(l)}}} = D{ij}^{(l)}](https://camo.githubusercontent.com/eacd507126656f6706438c4f357c7dae711a29d3/687474703a2f2f63686172742e617069732e676f6f676c652e636f6d2f63686172743f6368743d7478266368733d317830266368663d62672c732c4646464646463030266368636f3d3030303030302663686c3d253543667261632537422537422535437061727469616c2532304a25323825354354686574612532302532392537442537442537422537422535437061727469616c25323025354354686574612532305f253742696a2537442535452537422532386c253239253744253744253744253230253344253230445f253742696a2537442535452537422532386c253239253744)](https://camo.githubusercontent.com/eacd507126656f6706438c4f357c7dae711a29d3/687474703a2f2f63686172742e617069732e676f6f676c652e636f6d2f63686172743f6368743d7478266368733d317830266368663d62672c732c4646464646463030266368636f3d3030303030302663686c3d253543667261632537422537422535437061727469616c2532304a25323825354354686574612532302532392537442537442537422537422535437061727469616c25323025354354686574612532305f253742696a2537442535452537422532386c253239253744253744253744253230253344253230445f253742696a2537442535452537422532386c253239253744)，即得到代价函数的梯度

### 4. 梯度检查

- 检查利用`BP`求的梯度是否正确
- 利用导数的定义验证： [![\frac{{dJ(\theta )}}{{d\theta }} \approx \frac{{J(\theta  + \varepsilon ) - J(\theta  - \varepsilon )}}{{2\varepsilon }}](https://camo.githubusercontent.com/320fa457c8ae1335dfc6cac5cce24349ee5c1070/687474703a2f2f63686172742e617069732e676f6f676c652e636f6d2f63686172743f6368743d7478266368733d317830266368663d62672c732c4646464646463030266368636f3d3030303030302663686c3d25354366726163253742253742644a2532382535437468657461253230253239253744253744253742253742642535437468657461253230253744253744253230253543617070726f78253230253543667261632537422537424a2532382535437468657461253230253230253242253230253543766172657073696c6f6e2532302532392532302d2532304a25323825354374686574612532302532302d253230253543766172657073696c6f6e25323025323925374425374425374225374232253543766172657073696c6f6e253230253744253744)](https://camo.githubusercontent.com/320fa457c8ae1335dfc6cac5cce24349ee5c1070/687474703a2f2f63686172742e617069732e676f6f676c652e636f6d2f63686172743f6368743d7478266368733d317830266368663d62672c732c4646464646463030266368636f3d3030303030302663686c3d25354366726163253742253742644a2532382535437468657461253230253239253744253744253742253742642535437468657461253230253744253744253230253543617070726f78253230253543667261632537422537424a2532382535437468657461253230253230253242253230253543766172657073696c6f6e2532302532392532302d2532304a25323825354374686574612532302532302d253230253543766172657073696c6f6e25323025323925374425374425374225374232253543766172657073696c6f6e253230253744253744)
- 求出来的数值梯度应该与BP求出的梯度非常接近
- 验证BP正确后就不需要再执行验证梯度的算法了

### 5. 权重(theta)的随机初始化

- 神经网络不能像逻辑回归那样初始化`theta`为`0`,因为若是每条边的权重都为0，每个神经元都是相同的输出，在反向传播中也会得到同样的梯度，最终只会预测一种结果。
- 所以应该初始化为接近0的数

